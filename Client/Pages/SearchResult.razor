@page "/searchresult/{Query?}"
@inject NavigationManager NavigationManager
@inject SearchService SearchService

<h3>SearchResult</h3>

<table>
	<tr>
		<th>曲名</th>
		<th>タイアップ</th>
		<th>ファイル名</th>
	</tr>
	@foreach (AvailableSong availableSong in availableSongs)
	{
		<tr @key="@availableSong.Id">
			<td>@availableSong.SongName</td>
			<td>@availableSong.TieUpName</td>
			<td>@availableSong.Path</td>
			<td><button @onclick="() => OnClickRequest(availableSong)">予約</button></td>
		</tr>
	}
</table>


@code {
	[Parameter]
	public String? Query { get; set; }

	IEnumerable<AvailableSong> availableSongs = new AvailableSong[0];

	protected override async Task OnInitializedAsync()
	{
		try
		{
			availableSongs = await SearchService.SearchByWordAsync(Query);
		}
		catch (Exception excep)
		{
			Debug.WriteLine(excep.Message);
			Debug.WriteLine(excep.StackTrace);
		}
	}

	private void OnClickRequest(AvailableSong availableSong)
	{
		NavigationManager.NavigateTo($"/requestform/{availableSong.Id}");
	}

}
